---
title: "Continuous-Time Sequential Recommendation with Temporal Graph Collaborative Transformer, (CIKM'21)"
categories: [Paper, RecSys]
tags: [Sequential Recommendations, Transformer, GNN, Timesapn, SR]
img_path: /assets/img/posts/paper/recsys/tgsrec/
author: gshan
math: true
---

|[Paper Link][1]{:target="_blank"}|[Official Github][2]{:target="_blank"}|

## Abstract

Challenges
: 1. ê¸°ì¡´ì˜ SR(Sequential Recommendation) ë°©ë²•ë“¤(GRU4Rec, SASRec, etc.)ì€ sequential patternsë¥¼ í™œìš©í•˜ì§€ë§Œ, temporal collaborative signalsë¥¼ ë¬´ì‹œí•œë‹¤.
2. Collaborative signalsì˜ temporal effectsë¥¼ í‘œí˜„í•˜ëŠ” temporal collaborative signalsë¥¼ ì¶”ë¡ í•´ì•¼ í•œë‹¤.
3. Temporal collaborative signalsì™€ seuqnetial patternsë¥¼ ë™ì‹œì— encodeí•´ì•¼ í•œë‹¤.

Address
: 1. Temporal collaborative signalsì´ ì¤‘ìš”í•œ ì´ìœ ë¥¼ ë°íˆê³  ì´ë¥¼ í™œìš©í•˜ê³ ì í•œë‹¤.
2. TCT layerë¥¼ í†µí•´ signalsì— temporal effectsë¥¼ ê°€ì§„ temporal node embeddingsë¥¼ ì¶”ë¡ í•œë‹¤.
3. GNNì„ í†µí•´ sequential patternsì™€ temporal collaborative sigalsë¥¼ í†µí•©í•œë‹¤.


## â… . Introduction

ê¸°ì¡´ì˜ SR ë°©ë²•ë“¤ì€ ì‹œê°„ ìˆœìœ¼ë¡œ ê³¼ê±° interaction ì •ë³´ë¥¼ í™œìš©í•œë‹¤.
ì¦‰, sequential patternsë¥¼ ì´ìš©í•´ modelì„ í•™ìŠµì‹œí‚¨ë‹¤.
ì˜ˆë¥¼ ë“¤ì–´, transformerì˜ self-attention moduleì„ SR modelì— ì ìš© ì‹œí‚¨ ì—°êµ¬ë“¤ì—ì„œëŠ” ê³¼ê±°ì˜ itemsì— weightë¥¼ ë¶€ì—¬í•˜ê³  aggregationí•œë‹¤.

í•˜ì§€ë§Œ, ì´ëŸ¬í•œ ì—°êµ¬ë“¤ì€ sequential patternsë¥¼ í™œìš©í•˜ì§€ë§Œ, temporal collaborative signalsë¥¼ ë¬´ì‹œí•˜ê³  ìˆì–´ ë§Œì¡± í• ë§Œí•œ ì„±ëŠ¥ì„ ì´ëŒì–´ ë‚´ì§€ ëª»í•œë‹¤.

![](1.png)
_Figure 1: A toy example of temporal collaborative signals. Given the items that users $ğ‘¢_1$, $ğ‘¢_2$, $ğ‘¢_3$ and $ğ‘¢_4$ like in the past timestamps $ğ‘¡_1$, $ğ‘¡_2$, $ğ‘¡_3$ and $ğ‘¡_4$, the target is to recommend an item to $ğ‘¢_4$ at $ğ‘¡_5$ as the next item after $ğ‘–_2$._

Temporal collaborative signalsì˜ íš¨ê³¼ë¥¼ fig. 1ì„ í†µí•´ ì§ê´€ì ìœ¼ë¡œ ì•Œì•„ë³´ì.
Fig. 1ì€ $u_4$ê°€ $t_5$ì—ì„œ interactioní•  itemì„ ì˜ˆì¸¡í•˜ëŠ” ì˜ˆì œì´ë‹¤.

ë§Œì•½ sequential patternsë§Œ ì‚¬ìš©í•œë‹¤ë©´, $u_1, u_3$ì— ìˆëŠ” $i_2 \rightarrow i_3$ sequential patternì´ 2ë²ˆ ë‚˜íƒ€ë‚˜ë¯€ë¡œ $i_3$ì„ ì—ì¸¡í•  ê²ƒì´ë‹¤.
í•˜ì§€ë§Œ temporal collaborative signalì„ ê³ ë ¤í•œë‹¤ë©´, $i_4$ë¥¼ ì¶”ì²œí•  ê²ƒì´ë‹¤.
$u_2, u_4$ëŠ” $t_1$ì— $i_1$ê³¼ interactionì„ í•˜ì˜€ê³ , ê°ê° $t_3, t_4$ì— $i_2$ì™€ interactionì„ í•˜ì˜€ê¸° ë•Œë¬¸ì— ë†’ì€ user similarityë¥¼ ê°€ì§„ë‹¤ê³  ë³¼ ìˆ˜ ìˆë‹¤.
ì´ëŠ” ì €ìë“¤ì´ sequential patternsì™€ temporal collaborative signalsë¥¼ í†µí•©í•˜ë ¤ëŠ” ë™ê¸°ë¥¼ ë¶€ì—¬í–ˆë‹¤.

ì—¬ê¸°ì„œ í•´ê²°í•´ì•¼ í•  ì ì´ 2ê°€ì§€ê°€ ìˆë‹¤.
1. Collaborative signalsì™€ seuqnetial patternsë¥¼ ë™ì‹œì— encodeí•´ì•¼ í•œë‹¤.
ê¸°ì¡´ì˜ ë°©ë²•ë“¤ userê°„ì˜ ê´€ê³„ì„± ì¦‰, collaborative signalsë¥¼ í™œìš©í•˜ì§€ ì•ŠëŠ”ë‹¤.
2. Collaborative signalsì˜ ì˜í–¥ì„ temporal ê´€ì ì—ì„œ ì¸¡ì •í•´ì•¼ í•œë‹¤.
ì˜ˆë¥¼ ë“¤ì–´, fig. 1ì—ì„œ $u_2, u_4$ëŠ” $i_1$ì„ $t_1$ì— interactionì„ í–ˆì§€ë§Œ, ê°ê° $t_3, t_4$ì— $i_2$ì™€ interactionì„ í•˜ì˜€ë‹¤.
ì‹œì°¨ê°€ ìˆê¸° ë•Œë¬¸ì— ì‹œì°¨ë¥¼ ë¬´ì‹œí•˜ê³ , $u_4$ì— ë¼ì¹˜ëŠ” $u_2$ì˜ $i_1$ì™€ $i_2$ì˜ ê¸°ì—¬ë„ê°€ ê°™ë‹¤ê³  ê°€ì •í•˜ëŠ” ê²ƒì€ ë¬¸ì œê°€ ìˆë‹¤.
ë”°ë¼ì„œ collaborative signalsì˜ ì¤‘ìš”ì„±ì„ ì‹œê°„ì— ê¸°ë°˜í•´ êµ¬í•´ì•¼ í•œë‹¤.

Self-attentionì€ sequenceì—ì„œ item-itemì˜ ê´€ê³„ë§Œ í•™ìŠµí•œë‹¤.
ê·¸ë¦¬ê³  itemsì˜ temporal correlationsì„ captureí•˜ëŠ” moduleì´ ì—†ë‹¤.
ê·¸ë˜ì„œ ì €ìë“¤ì€ ìƒˆë¡œìš´ model TGSRec(Temporal Graph Sequential Recommender)ë¥¼ ì œì•ˆí•œë‹¤.
TGSRecì€ 2ê°€ì§€ componentsë¥¼ ê°€ì§„ë‹¤.

#### TCT(Temporal Collaborative Transformer) layer

ì²« ë²ˆì¬ componentëŠ” ê¸°ì¡´ì˜ transformer moduleì„ ë°œì „ì‹œí‚¨ ê²ƒì´ë‹¤.
Sequenceì—ì„œ collaborative signalsì„ explicití•˜ê²Œ modelingí•˜ê³ , sequenceì—ì„œ itemsì˜ temporal correlationsë¥¼ í‘œí˜„í•œë‹¤.

TCT layerëŠ” user-item interactions ì‚¬ì´ì˜ collaborative attentionì„ ì‚¬ìš©í•˜ê³ , temporal ì •ë³´ë¥¼ ê²°í•©ì‹œí‚¨ë‹¤.
Collaborative attentionì˜ query inputì€ target nodeê°€ ë˜ê³  key, value inputì€ target nodeì˜ ì´ì›ƒ nodesê°€ ëœë‹¤.
ì´ë¥¼ í†µí•´ TCT layerëŠ” ì‹œê°„ ì •ë³´ë¥¼ ê³ ë ¤í•˜ì—¬ ì´ì›ƒ nodesê³¼ì˜ interaction ì¤‘ìš”ì„±ì„ í•™ìŠµí•œë‹¤.

ì¦‰, TCT layerëŠ” temporal collaborative signalsë¥¼ captureí•˜ëŠ” ê²ƒì´ë‹¤.

#### Graph Information Propagation

![](2.png)
_Figure 2: The associated CTBG of Figure 1 and the inference of temporal embeddings of $u_4$ and $i_4$ at $t_5$._

ë‘ ë²ˆì§¸ componentëŠ” ì €ìë“¤ì´ ì œì•ˆí•œ Fig. 2(a)ì˜ CTBG (Continuous Time Bipartite Graph)ë¥¼ ê¸°ë°˜ìœ¼ë¡œ TCT layerì—ì„œ í•™ìŠµëœ temporal collaborative attentionì„ ì „íŒŒí•œë‹¤.

CTBGëŠ” edgeì˜ attributeë¡œ timestampê°€ ìˆëŠ” graphë¡œ, í•œ userì˜ neighbor itemsëŠ” sequential patternsë¥¼ ìœ ì§€í•˜ê³  ìˆë‹¤.
ì €ìë“¤ì€ CTBGì— ê¸°ë°˜í•´ í•™ìŠµëœ í•œ nodeì˜ temporal collaborative informationì„ neighbor nodesì— ì „íŒŒí•œë‹¤.

ê²°ë¡ ì ìœ¼ë¡œ ì €ìë“¤ì€ íŠ¹ì • timestampì—ì„œ ì¶”ë¡ ë˜ëŠ”, ë™ì ì¸ temporal embeddingì„ ì‚¬ìš©í•  ê²ƒì„ ì œì•ˆí•œë‹¤.
Fig. 2(b)ëŠ” TCTlayerë¥¼ í†µí•´ ì¶”ë¡ ëœ time $t_5$ì—ì„œ $u_4$ì™€ $i_4$ì˜ temporal inferenceì´ë‹¤.
ì´ë•Œ, ê³¼ê±° interactionsì˜ ì˜í–¥ì„ êµ¬ë¶„ì§“ê¸° ìœ„í•´ temporal ì •ë³´ë¥¼ í™œìš©í•œë‹¤.

#### Contributions

Temporal Collaborative Transformer
: Collaborative signalsê³¼ temporal effectsë¥¼ ë™ì‹œì— modeling í•´ì„œ temporal collaborative signalsë¥¼ ì¶”ë¡ í•œë‹¤.

Graph Sequential Recommendation
: Sequential patternsì™€ temporal collaborative signalsë¥¼ í†µí•©í•œë‹¤.  

## â…¡. Related Work

ìƒëµ

## â…¢. Definition And Preliminaries

ëª¨ë“  temporal interactionsë¥¼ í‘œí˜„í•˜ê¸° ìœ„í•´ edgeì˜ attributeë¡œ temporal informationì„ ê°€ì§€ëŠ” CTBGë¥¼ ì œì•ˆí•œë‹¤.

$\mathcal{I}_u(t)$
: the set of items interacted with the user $u$ before timestamp $t$

$\mathcal{I} \backslash \mathcal{I}_u(t)$
: Remaining items.

#### Continuous-Time Recommendation

íŠ¹ì • timestamp $t$ì—ì„œ ì£¼ì–´ì§„ user set $\mathcal{U}$ì™€ item set $\mathcal{I}$, ê´€ë ¨ëœ CTBGê°€ ì£¼ì–´ì§„ë‹¤.
ì´ ë•Œ, user $u$ì˜ continuous-time recommendationëŠ” $\mathcal{I} \backslash \mathcal{I}_u(t)$ì—ì„œ ranking listë¥¼ ë§Œë“œëŠ” ê²ƒì´ë‹¤.

#### Continuous-Time Sequential Recommendation

íŠ¹ì • user $u$ì™€ í•´ë‹¹ userì˜ ë¯¸ë˜ timestamps set $\mathcal{T}_u > T$ì´ ì£¼ì–´ì¡Œì„ ë•Œ,
ëª¨ë“  timestamp $t \in \mathcal{T}_u$ì— ëŒ€í•´ continuous-time recommendationì„ ìˆ˜í–‰í•˜ëŠ” ê²ƒì´ë‹¤.
ê·¸ë˜ì„œ ë‹¤ë¥¸ workë“¤ê³¼ ë‹¤ë¥´ê²Œ <span class="text-color-yellow">predictionì„ ì§„í–‰í•˜ë ¤ë©´ ë¯¸ë˜ì˜ timestampsê°€ ë°˜ë“œì‹œ í•„ìš”</span>í•˜ë‹¤.

## â…£. Proposed Model

![](3.png)

TGSRecì€ 3ê°œì˜ modulesë¥¼ ê°€ì§„ë‹¤.

Embedding layer
: SR ë¬¸ì œë¥¼ graph embedding methodì™€ ì—°ê²°í•˜ê¸° ìœ„í•´ nodesì™€ timestampsë¥¼ ë™ì¼í•œ ë°©ì‹ìœ¼ë¡œ encodeí•œë‹¤.

Temporal Collaborative Transformer (TCT) layer
: ì´ì›ƒì˜ temporal ì˜í–¥ì„ êµ¬ë¶„í•˜ê¸° ìœ„í•´ temporal collaborative attention mechanismì„ ê³ ì•ˆí•˜ê³ , temporal node embeddingì„ ì¶”ë¡ í•˜ê¸° ìœ„í•´ nodeì™€ time embedding ëª¨ë‘ aggregation í•œë‹¤.

Prediction layer
: ë§ˆì§€ë§‰ TCT layerì˜ output embeddingìœ¼ë¡œ scoreë¥¼ ê³„ì‚°í•œë‹¤.

### â…°. Embedding layer

ì €ìë“¤ì€ 2ê°€ì§€ ìœ í˜•ì˜ embedding: long-term embeddings and continuous-time embedding

#### Long-Term User/Item embeddings

Long-term collaborative signals representationì„ ìœ„í•´ user/itemì˜ long-term embeddingsê°€ í•„ìš”í•˜ë‹¤.
ìš°ë¦¬ê°€ ì•„ëŠ” ì¼ë°˜ì ì¸ user/item embedding $\in \mathcal{R}^d$ì´ë‹¤.

$$
\begin{split}
\textbf{E} &= \big[\textbf{E}_\mathcal{U};\textbf{E}_\mathcal{I} \big] \in \mathbb{R}^{d\times |\mathcal{V}|}\\
\mathcal{V} &= \mathcal{U} \cup \mathcal{I}
\end{split}
$$

Embedding table $\textbf{E}$ëŠ” temporal user/item embeddingsë¥¼ ì¶”ë¡ í•˜ê¸° ìœ„í•œ ì´ˆê¸° stateì´ë‹¤.
Training process ë™ì•ˆ $\textbf{E}$ëŠ” ìµœì í™” ëœë‹¤.

#### Continuous-Time embedding

Scalar timestampsë¥¼ vector encodingí•œë‹¤.
ì¦‰, timestampë§ˆë‹¤ time embeddingì„ ì–»ëŠ”ë‹¤.

$$
\Phi: T \mapsto \mathbb{R}^{d_T}, T \in \mathbb{R}^+
$$

Time spanì€ temporal effectë¥¼ í‘œí˜„í•˜ê³ , sequential patternsë¥¼ ì•Œì•„ë‚´ëŠ”ë° ì¤‘ìš”í•œ ì—­í• ì„ í•œë‹¤.
ì´ëŸ¬í•œ time spanì€ time embeddingsì˜ ë‚´ì ìœ¼ë¡œ í‘œí˜„ëœë‹¤.
ê·¸ë¦¬ê³  time spanì„ í†µí•´ temporal effectsë¥¼ ì •ì˜í•œë‹¤.

í•œ userì— ëŒ€í•´ í•œ ìŒì˜ interactions $(u, i, t_1), (u, j, t_2)$ì´ ì£¼ì–´ì¡Œì„ ë•Œ, temporal effect $\psi(t_1 - t_2)$ëŠ” ë‹¤ìŒê³¼ ê°™ì´ ì •ì˜ëœë‹¤.

$$
\begin{equation}
\psi(t_1 - t_2) = \mathcal{K}(t_1, t_2) = \Phi(t_1) \cdot \Phi(t_2) \in \mathbb{R}
\end{equation}
$$

- $\mathcal{K}$: temporal kernel

Temporal effect $\psi$ëŠ” ë‘ timestampsê°„ temporal correlationì„ ì¸¡ì •í•œë‹¤.
ê³ ë ¤í•´ì•¼ í•  ì ì€ ê´€ì°°ë˜ì§€ ì•Šì€ ë¯¸ë˜ì˜ timestampë„ encodingì„ í•˜ì—¬, ì–´ë– í•œ time sapnì´ë¼ë„ ì¶”ë¡ ë  ìˆ˜ ìˆì–´ì•¼ í•œë‹¤ëŠ” ê²ƒì´ë‹¤.
ì¦‰, ì„ì˜ì˜ timestamp pairì˜ temporal effectê°€ time representationì˜ ë‚´ì ìœ¼ë¡œ <span class="text-color-yellow">inductiveí•˜ê²Œ ì¶”ë¡ </span>ë˜ì–´ì•¼ í•œë‹¤.

ì´ëŠ” absolute time differenceë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê³ , eq. 1ì²˜ëŸ¼ kernel $\mathcal{K}$ë¡œ time representationì„ modelingí•¨ìœ¼ë¡œì¨ í•´ê²° ê°€ëŠ¥í•˜ë‹¤.
ì´ë•Œ, kernelì€ continuousí•˜ê³  tranlation-invariant í•´ì•¼ í•˜ê³ , [Bochner's Theorem][3]{:target="_blank"}ì„ ì‚¬ìš©í•´ ì´ë¥¼ ë‹¬ì„±í•œë‹¤.

$$
\begin{equation}
\Phi(t) \mapsto \sqrt{\frac{1}{d_T}}[\text{cos}(\omega_1 t), \text{sin}(\omega_1 t), \dots, \text{cos}(\omega_{d_T} t), \text{sin}(\omega_{d_T} t)]^\top
\end{equation}
$$

- $\boldsymbol{\omega} = [\omega_1, \dots, \omega_{d_T}]^\top$ì€ í•™ìŠµ ê°€ëŠ¥í•œ parameterì´ë‹¤.


### â…±. Temporal Collaborative Transformer

TCT layerì˜ ê°•ì ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.

1. Timestamps ê°„ì˜ correlationì¸ temporal effects $\psi$ë¥¼ explicití•˜ê²Œ í‘œí˜„í•˜ëŠ” temporal embeddingsì™€ user/item embeddingsë¡œë¶€í„° informationì„ ì–»ëŠ”ë‹¤.
2. Itme-item interactionë§Œ ê³ ë ¤í•˜ë˜ ê¸°ì¡´ì˜ self-attention mechanismì„ ë°œì „ì‹œí‚¨ collaborative attention moduleë¡œ user-itemì˜ ì¤‘ìš”ì„±ì„ modelingí•œ collaborative signalsë¥¼ explicití•˜ê²Œ í™œìš©í•œë‹¤.

ë¨¼ì € user nodeë¥¼ ì˜ˆì‹œë¡œ ë“¤ì–´ informationì„ constructioní•˜ê³  aggregationí•˜ëŠ” ê²ƒì„ ë³´ì—¬ì¤„ ê²ƒì´ë‹¤.
ê·¸ë¦¬ê³  collaborative attention mechanismì„ í†µí•´ interactionì˜ ì¤‘ìš”ì„±ì„ ì¶”ë¡ í•  ê²ƒì´ë‹¤.
ë§ˆì§€ë§‰ìœ¼ë¡œ item node ê´€ì ì—ì„œ ì´ë¥¼ ì¼ë°˜í™” í•œë‹¤.

#### Information Construction

ê° TCT layerì˜ inputì€ long term node embeddingsì™€ time embeddingsì˜ ì¡°í•©ìœ¼ë¡œ ì´ë¤„ì§„ë‹¤.
ì´ë¥¼ í†µí•´ temporal informationê³¼ collaborative signalsë¥¼ í†µí•©í•  ìˆ˜ ìˆê²Œ ëœë‹¤.

ì˜ˆë¥¼ ë“¤ì–´, time $t$ì—ì„œ user $u$ì— ëŒ€í•œ $l$ ë²ˆì§¸ TCT layerì˜ query $h_u^{l-1}(t)$ëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.

> $t$ëŠ” ê¼­ userê°€ íŠ¹ì • itemê³¼ interactionì´ ì¼ì–´ë‚œ ì‹œê°„ì´ ì•„ë‹ˆë¼, ì„ì˜ì˜ ì‹œê°„ì¸ ê²ƒ ê°™ë‹¤.

$$
\begin{equation}
\textbf{h}_u^{(l-1)}(t) = \textbf{e}_u^{(l-1)}(t) || \Phi(t),
\end{equation}
$$

- $h_u(t) \in \mathbb{R}^{d+d_T}$: time $t$ì—ì„œ user $u$ì˜ information.
- $e_u(t) \in \mathbb{R}^d$ : user $u$ì˜ temporal embedding
- $\Phi(t) \in \mathbb{R}^{d_T}$: time $t$ì˜ time vector

\|\|ëŠ” concatenationì„ ì˜ë¯¸í•œë‹¤. 
Summation ë“±ë„ ì‚¬ìš©í•  ìˆ˜ ìˆì§€ë§Œ, ê°„ê²°í•¨ì„ ìœ„í•´ concatenationì„ ì‚¬ìš©í•œë‹¤.
ê·¸ë¦¬ê³  concatenationì„ ì‚¬ìš©í•¨ìœ¼ë¡œì¨ eq. 7ì²˜ëŸ¼ í•´ì„ì„ ì¢€ ë” ì§ê´€ì ìœ¼ë¡œ í•  ìˆ˜ ìˆê²Œ ëœë‹¤.

Layerê°€ 1ì¼ ë•Œ, inputì˜ temporal embedding $e_u^{(0)}$ì€ $\textbf{E}_u$ë¡œ long-term user embeddingìœ¼ë¡œ timeê³¼ëŠ” ë¬´ê´€í•˜ë‹¤.
Layerê°€ 1ë³´ë‹¤ í´ ë•ŒëŠ” temporal embeddingì€ ì´ì „ TCT layerì—ì„œ ìƒì„±ëœ ê²ƒì„ ì‚¬ìš©í•œë‹¤.

> $e_u(t)$ë¼ê³  í‘œê¸°í•˜ëŠ” ê²ƒì€ 1ë²ˆì§¸ layerì´í›„, $t$ì— ë”°ë¼ temporal embedding ê°’ì´ ë‹¬ë¼ì§€ê¸° ë•Œë¬¸ì¸ ê²ƒ ê°™ë‹¤.

Query node ì™¸ì—ë„ ê·¸ê²ƒì˜ neithborsì˜ temporal collaborative informationì„ ì „íŒŒí•´ì•¼ í•œë‹¤.
ì €ìë“¤ì€ time $t$ ì´ì „ì— $u$ì™€ interactionì´ ì¼ì–´ë‚œ ì„œë¡œ ë‹¤ë¥¸ sample $S$ë¥¼ ë¬´ì‘ìœ„ë¡œ ë½‘ëŠ”ë‹¤.

$$
\mathcal{N}_u(t) = \{(i,t_s)|(u,i,t_s) \in \mathcal{E}_t \text{ and } t_s < t\}
$$

ê° $(i, t_s)$ ìŒë§ˆë‹¤ $l$ ë²ˆì§¸ layerì˜ input informationì€ ë‹¤ìŒê³¼ ê°™ë‹¤.

$$
\begin{equation}
\textbf{h}_i^{(l-1)}(t_s) = \textbf{e}_i^{(l-1)}(t_s) || \Phi(t_s),
\end{equation}
$$

- $h_i(t_s) \in \mathbb{R}^{d+d_T}$: time $t_s$ì—ì„œ item $i$ì˜ information.
- $e_u(t_s) \in \mathbb{R}^d$ : item $i$ì˜ temporal embedding
- $\Phi(t_s) \in \mathbb{R}^{d_T}$: time $t_s$ì˜ time vector

ìœ ì‚¬í•˜ì— Layerê°€ 1ì¼ ë•Œ, inputì˜ temporal embeddingì€ $\textbf{E}_i$ì´ê³ , 1ë³´ë‹¤ í´ ë•ŒëŠ” ì´ì „ TCT layerì—ì„œ ìƒì„±ëœ ê²ƒì´ë‹¤.

#### Information Propagation

Informationì„ constructí•œ ë’¤, samplingëœ ì´ì›ƒì˜ inforamtionì„ propagateí•˜ì—¬ temporal embedding $e_u$ì„ ì¶”ë¡ í•´ì•¼ í•œë‹¤.
ì´ì›ƒ nodesëŠ” time $t$ì™€ ê´€ë ¨ë˜ì–´ ìˆê¸° ë•Œë¬¸ì—, information propagationì„ í†µí•´ sequential patternsì™€ temporal collaborative signalsë¥¼ í†µí•©í•  ìˆ˜ ìˆë‹¤.
ì €ìë“¤ì€ ì•„ë˜ì™€ ê°™ì´ linear combinationìœ¼ë¡œ informationì„ propagationí•œë‹¤.

$$
\begin{equation}
  \textbf{e}_{\mathcal{N}_u}^{(l)}(t) = \sum_{(i, t_s) \in \mathcal{N}_u(t)}
    (\pi_t^u(i, t_s))^{(l)}\textbf{W}_v^{(l)}h_i^{(l-1)}(t_s)
\end{equation}
$$

- $\pi_t^u(i, t_s)$ëŠ” time $t$ì—ì„œ user $u$ì˜ temporal inferenceì— interaction $(u,i,t_s)$ì´ ë¼ì¹˜ëŠ” ì˜í–¥ì„ ì˜ë¯¸í•œë‹¤.
- $\textbf{W}_v \in \mathbb{R}^{d\times(d+d_T)}$ëŠ” linear transformation matrixì´ë‹¤.

#### Temporal Collaborative Attention

ì—¬ê¸°ì„œëŠ” information propagationì—ì„œ ì‚´í´ ë³¸ $\pi_t^u(i, t_s)$ë¥¼ collaborative attention mechanismìœ¼ë¡œ ì¸¡ì •í•œë‹¤.
Neighboring interactionsì™€ temporal informationì€ ê³¼ê±° interactionì˜ importanceì— ê¸°ì—¬í•˜ê³ , 
$\pi_t^u(i, t_s)$ëŠ” neighboring interactionsì™€ temporal informationì„ ë™ì‹œì— ê³ ë ¤í•œë‹¤.
ê·¸ë˜ì„œ ì˜¤ì§ item-item correlationsë§Œ ê³ ë ¤í•˜ëŠ” self-attention mechanismê³¼ ë‹¤ë¥´ê²Œ temporal collaborative signalsë¥¼ captureí•˜ëŠ” ë” ìœ ìš©í•œ mechanismì´ë‹¤.

$$
\begin{equation}
 (\pi_t^u(i, t_s))^{(l)} = \frac{1}{\sqrt{d+d_T}}\big(\textbf{W}_k^{(l)}h_i^{(l-1)}(t_s)\big)^\top\textbf{W}_q^{(l)}\textbf{h}_u^{(l-1)}(t)
\end{equation}
$$

- $\textbf{W}_k^{(l)}, \textbf{W}_q^{(l)}$ì€ transformation matricesì´ë‹¤.
- $1/\sqrt{d+d_T}$ì€ scalar factorë¡œ, userì™€ itemì˜ dimensionì´ ì»¤ì§ˆìˆ˜ë¡ ë‚´ì ì˜ ê°’ì´ ì»¤ì§€ëŠ” ê²ƒì„ ë°©ì§€í•˜ê¸° ìœ„í•œ regularizationì´ë‹¤.

ì €ìë“¤ì€ dot-productë¡œ attentionì„ êµ¬í•œë‹¤.
Eq. 3,4ì— ê¸°ë°˜í•´, transformation matricesë¥¼ ë¬´ì‹œí•˜ë©´ Eq. 6ì€ ì•„ë˜ì™€ ê°™ì•„ì§„ë‹¤.

$$
\begin{equation}
\textbf{e}^{(l-1)}_u(t) \cdot \textbf{e}_i^{(l-1)}(t_s) + \Pi(t)\cdot\Pi(t_s)
\end{equation}
$$

ì²« ë²ˆì§¸ termì€ user-item collaborative signalì´ê³  ë‘ ë²ˆì§¸ termì€ Eq. 1ì—ì„œ ì •ì˜í•œ temporal effectì´ë‹¤.
Layerê°€ ë” ìŒ“ì´ë©´, collaborative signalê³¼ temporal effectëŠ” entangleëœë‹¤.
ê·¸ë ‡ê¸° ë•Œë¬¸ì—, dot-product attentionì€ temporal collaborative signalsì˜ ì˜í–¥ì„ íŠ¹ì„±í™”í•  ìˆ˜ ìˆë‹¤.

ì´í›„ samplingëœ ëª¨ë“  ì´ì›ƒ interactionsì— ëŒ€í•´ softmaxë¡œ normalizeí•œë‹¤.

$$
\begin{equation}
\pi_t^u(i, t_s) = \frac{\text{exp}\big( \pi_t^u(i, t_s) \big)}{\sum_{(i^\prime, t_s^\prime \in \mathcal{N}_u(t))}\text{exp}\big(\pi_t^u(i^\prime, t^\prime_s)\big)}
\end{equation}
$$

êµ¬í˜„ì€ Eq. 4ì—ì„œ êµ¬í•œ ì´ì›ƒì˜ informationì„ stackingí•˜ì—¬ matrixë¡œ ë‚˜íƒ€ë‚¸ë‹¤.
ê·¸ë¦¬ê³  temporal collaborative attention moduleì˜ inputì¸ query, key, valueë„ matrixë¡œ í‘œí˜„í•˜ë©´, ë‹¤ìŒê³¼ ê°™ë‹¤. 

$$
\begin{split}
& \textbf{H}_{\mathcal{N}_u}^{(l-1)}(t) \in \mathbb{R}^{(d + d_t) \times S}, \\
& \textbf{K}_u^{(l-1)}(t) = \textbf{W}_k^{(l)}\textbf{H}_{\mathcal{N}_u}^{(l-1)}(t), \\
& \textbf{V}_u^{(l-1)}(t) = \textbf{W}_v^{(l)}\textbf{H}_{\mathcal{N}_u}^{(l-1)}(t), \\
& \textbf{q}_u^{(l-1)}(t) = \textbf{W}_q^{(l)}\textbf{h}_u^{(l-1)}(t), \\
\end{split}
$$

ì´ëŠ” Fig. 3ì— ì´ˆë¡ìƒ‰ìœ¼ë¡œ ë‚˜íƒ€ë‚˜ ìˆë‹¤.
ê°„ê²°í•¨ê³¼ ëª¨í˜¸ì„±ì„ ì—†ì• ê¸° ìœ„í•´, layerì™€ time $t$ì—†ì´ Eq. 6ê³¼ 8ì„ í•©ì¹˜ì„œ Eq. 5ë¥¼ ë‚˜íƒ€ë‚´ë©´ ì•„ë˜ì™€ ê°™ì•„ì§„ë‹¤.

$$
\begin{equation}
\textbf{e}_{\mathcal{N}_u} = \textbf{V}_u \cdot \text{softmax} \bigg( \frac{\textbf{K}_u^\top q_u}{\sqrt{d + d_T}} \bigg)
\end{equation}
$$

ì´ëŠ” Transformerì— ìˆëŠ” dot-product attention í˜•íƒœë¡œ, multi-head attention ì—°ì‚°ì„ ì ìš©í•  ìˆ˜ ìˆê³ , ê° headì—ì„œ ë‚˜ì˜¨ informationì„ concatenateìœ¼ë¡œ aggregationí•œë‹¤.

#### Information Aggregation

$l$ ë²ˆì§¸ nodeì˜ embeddingì„ ì–´ê¸° ìœ„í•´ TCT layer ë§ˆì§€ë§‰ ë‹¨ê³„ì—ì„œëŠ” Eq. 3ì— ìˆëŠ” query informationê³¼ Eq. 5ì— ìˆëŠ” ì´ì›ƒ informationì„ FFNìœ¼ë¡œ aggergateí•œë‹¤.

$$
\begin{equation}
\textbf{e}^{(l)}_u(t) 
  = \text{FFN}\bigg( \textbf{e}_{\mathcal{N_u}}^{(l)}(t) || \textbf{h}_u^{(l-1)}(t) \bigg)
\end{equation}
$$

- $e_u^{(l)}(t)$ëŠ” layer $l$ì—ì„œ time $t$ì¼ ë•Œ user $u$ì˜ temporal embeddingì´ë‹¤.
- FFNì€ 2ê°œì˜ linear layerì™€ RELU activation í•¨ìˆ˜ë¡œ ì´ë¤„ì ¸ ìˆë‹¤.

#### Generalization to items

Itemì´ queryì¼ ë•Œë„ ì•ì—ì„œ userì™€ í–ˆë˜ ê²ƒê³¼ ìœ ì‚¬í•˜ê²Œ ì§„í–‰ëœë‹¤.
ë‹¨ì§€ Eq. 4, 5ì—ì„œ neighborê°€ user-time pairê°€ ë˜ëŠ” ê²ƒì´ë‹¤.


### â…². Model Prediction

Testì˜ inputìœ¼ë¡œ $(u,i,t)$ tripletì´ ì‚¬ìš©ëœë‹¤.
ê·¸ë¦¬ê³  TCT layerë¥¼ í†µí•´ ë§ˆì§€ë§‰ layerì—ì„œ $\text{e}_u^L(t), \textbf{e}_i^L(t)$ì„ ì–»ì–´ì„œ ë‚´ì ì„ í†µí•´ scoreë¥¼ ê³„ì‚°í•œë‹¤.

$$
\begin{equation}
r(u,i,t) = \textbf{e}_u^{(L)}(t) \cdot \textbf{e}_i^{(L)}(t)
\end{equation}
$$

### â…³. BPR Loss

Optimizationìœ¼ë¡œ BPR lossë¥¼ ì‚¬ìš©í•œë‹¤.

$$
\begin{equation}
\mathcal{L}_{\text{bpr}} = \sum_{(u,i,j,t) \in \mathcal{O}_T} -\text{log} \sigma(r(u,i,t) - r(u,j,t)) + \lambda||\Theta||^2_2
\end{equation}
$$

- $\mathcal{O}_T$ëŠ” training samplesë¥¼ ëœ»í•œë‹¤.
- $\Theta$ëŠ” ëª¨ë“  í•™ìŠµ ê°€ëŠ¥í•œ parameterì´ë‹¤.
- $\sigma(\cdot)$ì€ sigmoid functionì´ë‹¤.

Traning samplesëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.

$$
\mathcal{O}_T = \{(u,i,j,t)|(u,i,t) \in \mathcal{E}_t, j \in \mathcal{I}\backslash\mathcal{I}_u(t)\}
$$

## â…¤. Experiments

ìƒëµ...


[1]: https://arxiv.org/abs/2108.06625
[2]: https://github.com/DyGRec/TGSRec
[3]: https://en.wikipedia.org/wiki/Bochner%27s_theorem
